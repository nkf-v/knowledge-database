Предыдущий раздел уже упоминал, что простой сбор корней незначительно влияет на производительность, но это если сравнивать PHP 5.2 с PHP 5.3. Хотя запись корней в буфер по сравнению с отсутствием такой записи в PHP 5.2 замедляет работу приложения, другие изменения в работе PHP 5.3 во время выполнения кода предотвратили даже проявление этой конкретной потери производительности.

Производительность страдает в двух главных областях. Первая область — уменьшение размера памяти, которую PHP тратит на запись корней, а вторая — задержка во время выполнения кода, когда механизм сборки мусора очищает память. Рассмотрим обе проблемы.

### Уменьшение размера памяти

Первая причина появления в языке механизма сборки мусора, состоит в уменьшении размера памяти, которую занимает мусор, путём очистки переменных с циклическими ссылками в тот момент, когда выполнятся предварительные условия. В реализации PHP сборка мусора начинается, как только заполняется корневой буфер или при вызове функции [`gc_collect_cycles()`](https://www.php.net/manual/ru/function.gc-collect-cycles.php). График ниже показывает, как скрипт под графиком занимает память в PHP 5.2 и PHP 5.3, без учёта памяти, которую занимает сам PHP при запуске.

```php
class Foo  
{  
	public $var = '3.14159265359';  
	public $self;  
}  
  
$baseMemory = memory_get_usage();  
  
for ($i = 0; $i <= 100000; $i++) {  
	$a = new Foo();  
	$a->self = $a;  
	if ($i % 500 === 0) {  
		echo sprintf('%8d: ', $i), memory_get_usage() - $baseMemory, "\n";  
	}  
}
```